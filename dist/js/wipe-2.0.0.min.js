/*!BuildUpFromNothing-wipe 2.0.0 发布日期：2018-11-19*/
function Wipe(t){this.conID=t.id,this.coverType=t.coverType,this.color=t.color||"#666",this._w=t.width,this._h=t.height,this.imgUrl=t.imgUrl,this.opcity=t.opcity,this.cas=document.getElementById(this.conID),this.cas.width=this._w,this.cas.height=this._h,this.cas.style.background="url("+t.backImgUrl+") center 0 no-repeat",this.cas.style.backgroundSize="cover",this.context=this.cas.getContext("2d"),this.raduis=t.raduis,this.movex=0,this.movey=0,this.isMouseDown=!1,this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.drawMask(),this.callback=t.callback,this.transpercent=t.transpercent,this.lick()}Wipe.prototype.drawMask=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.globalAlpha=this.opcity,this.context.fillRect(0,0,375,667),this.context.globalCompositeOperation="destination-out";else if("image"===this.coverType){var t=this;this.imgs=new Image,this.imgs.src=this.imgUrl,this.imgs.onload=function(){t.context.drawImage(t.imgs,0,0,imgs.width,imgs.height,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getAllLeft=function(t){for(this.allLeft=0;t;)this.allLeft+=t.offsetLeft,t=t.offsetParent;return this.allLeft},Wipe.prototype.getAllTop=function(t){for(this.allTop=0;t;)this.allTop+=t.offsetTop,t=t.offsetParent;return this.allTop},Wipe.prototype.drawT=function(t,e,i,o){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.raduis,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.globalAlpha=1,this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.beginPath(),this.context.lineCap="round",this.context.lineWidth=2*this.raduis,this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.globalAlpha=1,this.context.stroke(),this.context.restore()}},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4){0===e.data[i+3]&&t++}return this.percent=t/(this._w*this._h)*100,Math.round(this.percent)},Wipe.prototype.lick=function(){var r=this;this.Press=this.device?"touchstart":"mousedown",this.Move=this.device?"touchmove":"mousemove",this.Uplift=this.device?"touchend":"mouseup",this.cas.addEventListener(this.Press,function(t){var e=t||window.event,i=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;e.preventDefault(),r.device?(r.movex=e.touches[0].clientX-r.getAllLeft(r.cas)+o,r.movey=e.touches[0].clientY-r.getAllTop(r.cas)+i):(r.movex=e.clientX-r.getAllLeft(r.cas)+o,r.movey=e.clientY-r.getAllTop(r.cas)+i),r.drawT(r.movex,r.movey),r.isMouseDown=!0},!1),this.cas.addEventListener(this.Move,function(t){if(!r.isMouseDown)return!1;var e=t||window.event,i=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;e.preventDefault();var s=r.device?e.touches[0].clientX:e.clientX,n=r.device?e.touches[0].clientY:e.clientY,c=s-r.getAllLeft(r.cas)+o,l=n-r.getAllTop(r.cas)+i;r.drawT(r.movex,r.movey),r.drawT(r.movex,r.movey,c,l),r.movex=c,r.movey=l;var h=r.getTransparencyPercent();r.callback.call(null,h),h>r.transpercent&&(r.clearRect(),r.isMouseDown=!1)},!1),this.cas.addEventListener(this.Uplift,function(t){r.isMouseDown=!1},!1)};